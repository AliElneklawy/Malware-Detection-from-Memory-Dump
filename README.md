# Malware-Detection-from-Memory-Dump
Obfuscated malware refers to a type of malicious software that deliberately conceals itself to evade detection and removal. This form of malware can be identified by examining the memory dump of the infected device.

This project is a multi-class, multi-output classification project. For each instance in the training set, there exists 2 labels and one of the labels (SubType column) has 4 classes.
The project aims to detect whether or not a specific device is infected and if it is infected, determine the type of malware. Three types of malware are included in the data set; Spyware, Ransomware, and Trojan. 

After training multiple models and evaluating them, the following results were reached:
The repository includes three models:

- A random forest model that includes all the features in the data set.
- A random forest model that drops the least important features.
- A neural network model.

The random forest model with the least important features dropped exhibited the best performance. The classification report for the multiclass label for this model is shown below.
| Class | Precision | Recall | F1-Score | Support |
|:-----:|:---------:|:------:|:--------:|:-------:|
|   0   |   1.00    |  1.00  |   1.00   |  4981   |
|   1   |   0.73    |  0.72  |   0.73   |  1665   |
|   2   |   0.78    |  0.79  |   0.78   |  1703   |
|   3   |   0.72    |  0.72  |   0.72   |  1613   |
|-----|---------|------|--------|-------|
| Macro Avg | 0.81  |  0.81  |   0.81   |  9962   |
| Weighted Avg | 0.87 |  0.87  |   0.87   |  9962   |

where 
- class 0 = Benign
- class 1 = Ransomware
- class 2 = Spyware
- class 3 = Trojan

The neural network model exhibited a poorer perfomance (for the multiclass label, too).
| Class | Precision | Recall | F1-Score | Support |
|:-----:|:---------:|:------:|:--------:|:-------:|
|   0   |   1.00    |  1.00  |   1.00   |  4981   |
|   1   |   0.71    |  0.13  |   0.22   |  1665   |
|   2   |   0.36    |  0.97  |   0.52   |  1703   |
|   3   |   0.86    |  0.03  |   0.05   |  1613   |
|-----|---------|------|--------|-------|
| Macro Avg | 0.73  |  0.53  |   0.45   |  9962   |
| Weighted Avg | 0.82 |  0.69  |   0.63   |  9962   |


For the binary lable, both the models did a good job. This means that both the models will almost always detect a malware but they will sometimes give wrong malware types. 

The random forest model will require the inputs to be normalized using `min_max_scaler` (defined in the notebook). The neural network can accept unnormalized inputs.
# Example

#### Input
| Feature                           | Value     |
|----------------------------------|----------|
| pslist_avg_threads               | 0.540605 |
| pslist_avg_handlers              | 0.007014 |
| dlllist_ndlls                   | 0.320591 |
| dlllist_avg_dlls_per_proc        | 0.690302 |
| handles_nhandles                | 0.004642 |
| handles_avg_handles_per_proc     | 0.004088 |
| handles_nfile                   | 0.000466 |
| handles_nevent                  | 0.283136 |
| handles_nkey                    | 0.161493 |
| handles_nthread                 | 0.060392 |
| handles_nsemaphore              | 0.078550 |
| handles_ntimer                  | 0.172524 |
| handles_nsection                | 0.008677 |
| handles_nmutant                 | 0.309677 |
| ldrmodules_not_in_load           | 0.166667 |
| ldrmodules_not_in_init           | 0.274194 |
| ldrmodules_not_in_mem            | 0.166667 |
| ldrmodules_not_in_load_avg       | 0.023340 |
| ldrmodules_not_in_init_avg       | 0.022072 |
| ldrmodules_not_in_mem_avg        | 0.023340 |
| malfind_ninjections              | 0.003195 |
| svcscan_nservices                | 0.980066 |
| svcscan_kernel_drivers           | 0.994012 |
| svcscan_shared_process_services  | 0.978261 |
| svcscan_nactive                  | 0.929293 |

#### Random Forest (after dropping the least important features) Output
![image](https://github.com/AliElneklawy/Malware-Detection-from-Memory-Dump/assets/89526026/395b305d-3b0f-4cb2-bf4f-1c1e59d4c65f)

