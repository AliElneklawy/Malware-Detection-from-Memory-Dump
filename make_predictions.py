import random
from time import sleep
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')
import joblib

df = pd.read_csv(r'C:\Users\ALJAZEERA\Desktop\malware detection\tstfile.csv').drop(columns=['Unnamed: 0'])
subtype_dict = {0: 'Benign', 1: 'Ransomware', 2: 'Spyware', 3: 'Trojan'}

rf = joblib.load(r'C:\Users\ALJAZEERA\Desktop\malware detection\rf_model_drop_less_imp_feats.joblib.gz')

while True:
    random_index = random.randint(0, len(df) - 1)
    random_sample = df.iloc[random_index, :]

    prediction = rf.predict([random_sample])
    prediction_proba = rf.predict_proba([random_sample])
    if prediction[0][1] == 1:
        attack_type = subtype_dict[prediction[0][0]]
        certainity = np.max(prediction_proba[0] * 100)
        print()
        print('\x1b[31mMALWARE DETECTED')
        print(f'Expected malware type: {attack_type}')
        print(f'Certainity: {certainity}%\x1b[0m')
        print()
    else:
        print('\033[92mAll Safe\033[0m')
    sleep(2)

